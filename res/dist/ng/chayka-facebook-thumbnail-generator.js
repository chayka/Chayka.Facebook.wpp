"use strict";angular.module("chayka-facebook-thumbnail-generator",["chayka-forms","chayka-nls","chayka-wp-admin","chayka-utils"]).directive("facebookThumbnailGenerator",["utils",function(a){return{restrict:"A",replace:!0,templateUrl:a.getResourceUrl("facebook","ng/chayka-facebook-thumbnail-generator.html"),scope:{model:"=",blocks:"=?",fonts:"=?",postId:"@?"},controller:["$scope","$element",function(b,c){angular.extend(b,{blockControls:{},tab:"background",init:function(){a.setDefaults(b.model,{background:{url:""},logo:{url:"",x:0,unitX:"px",y:0,unitY:"px",width:100,unitWidth:"px",anchor:"left-top"},fade:{backgroundColor:"#000000",backgroundOpacity:50}});for(var c in b.blocks)b.blocks.hasOwnProperty(c)&&(b.model[c]=b.model[c]||{})},getThumbnailElement:function(a){return c.find(".thumbnail_preview ."+a)},getBlockStyle:function(a){var c=b.blockControls[a]&&b.blockControls[a].getBlockStyle()||{};return"background"===a&&(c["background-image"]=b.model.background.url&&"url("+b.model.background.url+")"),c},getCanvasStyle:function(){return{height:b.model.background&&b.model.background.url?c.find(".thumbnail_preview .preview_background").height()+"px":"315px"}},activateTab:function(a){b.tab=a},isTabActive:function(a){return a===b.tab}}),b.init()}],link:function(a,b,c){}}}]).directive("facebookAnchorPicker",[function(){return{restrict:"A",replace:!0,template:'<div class="facebook-anchor_picker {{value}}" data-ng-click="pickAnchor($event)"></div>',scope:{value:"=",onChange:"&?"},controller:["$scope","$element",function(a,b){angular.extend(a,{value:a.value||"left-top",pickAnchor:function(c){var d=b.width()/3,e=b.height()/3,f=Math.ceil(c.offsetX/d),g=Math.ceil(c.offsetY/e),h="left",i="top";switch(f){case 1:h="left";break;case 2:h="center";break;case 3:h="right"}switch(g){case 1:i="top";break;case 2:i="center";break;case 3:i="bottom"}var j=h+"-"+i,k=j!==a.value;a.value=j,a.onChange&&k&&a.onChange()}})}]}}]).directive("facebookThumbnailBlockControl",["utils",function(a){return{restrict:"A",replace:!0,templateUrl:a.getResourceUrl("facebook","ng/chayka-facebook-thumbnail-block-control.html"),scope:{api:"=?facebookThumbnailBlockControl",model:"=",block:"@",optional:"@?",title:"@",tabsStr:"@tabs",imageHint:"@?",text:"=?",fonts:"=?"},controller:["$scope",function(b){angular.extend(b,{tabs:b.tabsStr&&b.tabsStr.split(/\s+/)||[],units:["px","%"],anchors:{"left-top":"Top Left","center-top":"Top Center","right-top":"Top Right","left-center":"Center Left","center-center":"Center","right-center":"Center Right","left-bottom":"Bottom Left","center-bottom":"Bottom Center","right-bottom":"Bottom Right"},init:function(){b.tab=b.tabs[0],b.isTabShown("position")&&a.setDefaults(b.model,{x:0,unitX:"px",y:0,unitY:"px",width:50,unitWidth:"%",anchor:"left-top"}),b.isTabShown("text")&&a.setDefaults(b.model,{fontFamily:"",fontSize:20,color:"#ffffff",textAlign:"left"}),b.isTabShown("box")&&a.setDefaults(b.model,{backgroundColor:"#000000",backgroundOpacity:0,borderColor:"#ffffff",borderWidth:0,borderWidthTop:0,borderWidthRight:0,borderWidthBottom:0,borderWidthLeft:0,padding:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0})},isTabShown:function(a){return b.tabs.indexOf(a)>=0},hashColorAndOpacityToRGB:function(a,b){a=a.replace("#",""),3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var c=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),e=parseInt(a.substring(4,6),16);return"rgba("+c+","+d+","+e+","+b/100+")"},convertBlockStyle:function(c){var d=b.$parent.getThumbnailElement(b.block),e=d.position(),f=b.model,g=e.left,h=a.getItem(f,"unitX","px"),i=e.top,j=a.getItem(f,"unitY","px"),k=d.outerWidth(),l=d.outerHeight(),m=a.getItem(f,"unitWidth","%"),n=a.getItem(f,"anchor","left-top"),o=d.parent().width(),p=d.parent().height();switch(n){default:case"left-top":break;case"center-top":g+=Math.floor(k/2);break;case"right-top":g+=Math.floor(k);break;case"left-center":i+=Math.floor(l/2);break;case"center-center":g+=Math.floor(k/2),i+=Math.floor(l/2);break;case"right-center":g+=Math.floor(k),i+=Math.floor(l/2);break;case"left-bottom":i+=l;break;case"center-bottom":g+=Math.floor(k/2),i+=l;break;case"right-bottom":g+=Math.floor(k),i+=Math.floor(l/2)}var q="%"===j?Math.round(i/p*100):i,r="%"===h?Math.round(g/o*100):g,s="%"===m?Math.round(k/o*100):k;angular.extend(b.model,{x:r,y:q,width:s})},getBlockStyle:function(){var c=b.$parent.getThumbnailElement(b.block),d=b.model,e={};if(b.isTabShown("text")&&angular.extend(e,{"font-family":d.fontFamily||"inherit","font-size":d.fontSize?d.fontSize+"px":"1em",color:d.color||"#FFFFFF","text-align":d.textAlign}),b.isTabShown("position")){var f=a.getItem(d,"x",0),g=a.getItem(d,"unitX","px"),h=a.getItem(d,"y",0),i=a.getItem(d,"unitY","px"),j=a.getItem(d,"width",50),k=a.getItem(d,"unitWidth","%"),l=a.getItem(d,"anchor","left-top"),m=c.outerWidth(),n=c.outerHeight(),o=m/n,p=c.parent().width(),q=c.parent().height(),r="%"===i?Math.round(h/100*q):h,s="%"===g?Math.round(f/100*p):f,t="%"===k?Math.round(j/100*p):j,u=Math.round(t/o);switch(l){default:case"left-top":break;case"center-top":s-=Math.floor(t/2);break;case"right-top":s-=Math.floor(t);break;case"left-center":r-=Math.floor(u/2);break;case"center-center":s-=Math.floor(t/2),r-=Math.floor(u/2);break;case"right-center":s-=Math.floor(t),r-=Math.floor(u/2);break;case"left-bottom":r-=u;break;case"center-bottom":s-=Math.floor(t/2),r-=u;break;case"right-bottom":s-=Math.floor(t),r-=Math.floor(u/2)}angular.extend(e,{top:r,left:s,width:t})}if(b.isTabShown("box")){var v=d.borderWidth&&d.borderWidth+"px"||"0",w=[];d.borderWidth<0&&(w.push((d.borderWidthTop&&d.borderWidthTop+"px"||0)+""),w.push((d.borderWidthRight&&d.borderWidthRight+"px"||0)+""),w.push((d.borderWidthBottom&&d.borderWidthBottom+"px"||0)+""),w.push((d.borderWidthLeft&&d.borderWidthLeft+"px"||0)+""),v=w.join(" "));var x=d.padding&&d.padding+"px"||"0",y=[];d.borderWidth<0&&(y.push((d.paddingTop&&d.paddingTop+"px"||0)+""),y.push((d.paddingRight&&d.paddingRight+"px"||0)+""),y.push((d.paddingBottom&&d.paddingBottom+"px"||0)+""),y.push((d.paddingLeft&&d.paddingLeft+"px"||0)+""),x=y.join(" ")),angular.extend(e,{"background-color":b.hashColorAndOpacityToRGB(d.backgroundColor||"#000",d.backgroundOpacity||0),border:"solid "+d.borderColor,"border-width":v,padding:x})}return b.optional&&(e=d.active?angular.extend(e,{visibility:"visible"}):{visibility:"hidden"}),e},switchComplexity:function(a){var c=b.model;c[a]>=0?(c[a+"Top"]=c[a],c[a+"Right"]=c[a],c[a+"Bottom"]=c[a],c[a+"Left"]=c[a],c[a]=-1):c[a]=Math.max(c[a+"Top"],c[a+"Right"],c[a+"Bottom"],c[a+"Left"])},renderBlock:function(){}}),b.init(),b.api={getBlockStyle:b.getBlockStyle}}]}}]);
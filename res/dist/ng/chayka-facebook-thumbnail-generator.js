"use strict";angular.module("chayka-facebook-thumbnail-generator",["chayka-forms","chayka-nls","chayka-wp-admin","chayka-utils"]).directive("facebookThumbnailGenerator",["utils",function(a){return{restrict:"A",replace:!0,templateUrl:a.getResourceUrl("facebook","ng/chayka-facebook-thumbnail-generator.html"),scope:{model:"=",blocks:"=?",fonts:"=?",postId:"@?"},controller:["$scope","$element",function(a,b){angular.extend(a,{blockControls:{},tab:"background",model:angular.extend({background:{url:""},logo:{url:"",x:0,unitX:"px",y:0,unitY:"px",width:100,unitWidth:"px"},fade:{color:"#000000",opacity:50}},a.model||{}),init:function(){},getThumbnailElement:function(a){return b.find(".thumbnail_preview ."+a)},getBlockStyle:function(b){var c=a.model,d=c&&c[b]?{visibility:c[b].active?"visible":"hidden","font-family":c[b].font?c[b].font:"inherit","font-size":c[b].size?c[b].size+"px":"1em",color:c[b].color?c[b].color:"#FFFFFF"}:{visibility:"hidden"};return a.blockControls[b]&&angular.extend(d,a.blockControls[b].getBlockStyle()),d},getLogoStyle:function(){var b={};return a.blockControls.logo&&angular.extend(b,a.blockControls.logo.getBlockStyle()),b}}),a.init()}],link:function(a,b,c){}}}]).directive("facebookAnchorPicker",[function(){return{restrict:"A",replace:!0,template:'<div class="facebook-anchor_picker {{value}}" data-ng-click="pickAnchor($event)"></div>',scope:{value:"="},controller:["$scope","$element",function(a,b){angular.extend(a,{value:a.value||"left-top",pickAnchor:function(c){var d=b.width()/3,e=b.height()/3,f=Math.ceil(c.offsetX/d),g=Math.ceil(c.offsetY/e),h="left",i="top";switch(f){case 1:h="left";break;case 2:h="center";break;case 3:h="right"}switch(g){case 1:i="top";break;case 2:i="center";break;case 3:i="bottom"}a.value=h+"-"+i,console.dir({"facebookAnchorPicker.pickAnchor":c,el:b,x:f,y:g,value:a.value})}})}]}}]).directive("facebookThumbnailBlockControl",[function(){return{restrict:"A",replace:!0,template:'<div class="facebook-thumbnail_block_control">   <div class="block_field anchor">       <label>{{"Anchor" | nls}}:</label>       <select data-ng-model="model.anchor" data-ng-options="anchor as text for (anchor, text) in anchors" data-ng-change="convertBlockStyle()"></select>       <div data-facebook-anchor-picker data-value="model.anchor"></div>   </div>   <div class="block_field size coord_x">       <label>{{"Coord X" | nls}}:</label>       <input type="number" data-ng-model="model.x" min="0">       <select data-ng-model="model.unitX" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>   </div>   <div class="block_field size coord_y">       <label>{{"Coord Y" | nls}}:</label>       <input type="number" data-ng-model="model.y" min="0">       <select data-ng-model="model.unitY" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>   </div>   <div class="block_field size width">       <label>{{"Width" | nls}}:</label>       <input type="number" data-ng-model="model.width" min="0">       <select data-ng-model="model.unitWidth" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>   </div></div>',scope:{api:"=?facebookThumbnailBlockControl",model:"=",block:"@"},controller:["$scope",function(a){angular.extend(a,{model:angular.extend({x:0,unitX:"px",y:0,unitY:"px",width:50,unitWidth:"%",anchor:"left-top"},a.model),units:["px","%"],anchors:{"left-top":"Top Left","center-top":"Top Center","right-top":"Top Right","left-center":"Center Left","center-center":"Center","right-center":"Center Right","left-bottom":"Bottom Left","center-bottom":"Bottom Center","right-bottom":"Bottom Right"},convertBlockStyle:function(){},getBlockStyle:function(){var b=a.$parent.getThumbnailElement(a.block),c=a.model,d=b.width(),e=b.height(),f=d/e,g=b.parent().width(),h=b.parent().height(),i="%"===c.unitY?Math.round(c.y/100*h):c.y,j="%"===c.unitX?Math.round(c.x/100*g):c.x,k="%"===c.unitWidth?Math.round(c.width/100*g):c.width,l=Math.round(k/f);switch(c.anchor){case"left-top":break;case"center-top":j-=Math.floor(k/2);break;case"right-top":j-=Math.floor(k);break;case"left-center":i-=Math.floor(l/2);break;case"center-center":j-=Math.floor(k/2),i-=Math.floor(l/2);break;case"right-center":j-=Math.floor(k),i-=Math.floor(l/2);break;case"left-bottom":i-=l;break;case"center-bottom":j-=Math.floor(k/2),i-=l;break;case"right-bottom":j-=Math.floor(k),i-=Math.floor(l/2)}return{top:i,left:j,width:k}},renderBlock:function(){}}),a.api={getBlockStyle:a.getBlockStyle}}]}}]);
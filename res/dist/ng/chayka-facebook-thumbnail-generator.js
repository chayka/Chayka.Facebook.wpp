"use strict";angular.module("chayka-facebook-thumbnail-generator",["chayka-forms","chayka-nls","chayka-wp-admin","chayka-utils"]).directive("facebookThumbnailGenerator",["utils",function(a){return{restrict:"A",replace:!0,templateUrl:a.getResourceUrl("facebook","ng/chayka-facebook-thumbnail-generator.html"),scope:{model:"=",blocks:"=?",fonts:"=?",postId:"@?"},controller:["$scope","$element",function(b,c){angular.extend(b,{blockControls:{},tab:"background",init:function(){a.setDefaults(b.model,{background:{url:""},logo:{url:"",x:0,unitX:"px",y:0,unitY:"px",width:100,unitWidth:"px",anchor:"left-top"},fade:{color:"#000000",opacity:50}});for(var c in b.blocks)b.blocks.hasOwnProperty(c)&&(b.model[c]=b.model[c]||{})},getThumbnailElement:function(a){return c.find(".thumbnail_preview ."+a)},getBlockStyle:function(a){return b.blockControls[a].getBlockStyle()},getLogoStyle:function(){var a={};return b.blockControls.logo&&angular.extend(a,b.blockControls.logo.getBlockStyle()),a}}),b.init()}],link:function(a,b,c){}}}]).directive("facebookAnchorPicker",[function(){return{restrict:"A",replace:!0,template:'<div class="facebook-anchor_picker {{value}}" data-ng-click="pickAnchor($event)"></div>',scope:{value:"=",onChange:"&?"},controller:["$scope","$element",function(a,b){angular.extend(a,{value:a.value||"left-top",pickAnchor:function(c){var d=b.width()/3,e=b.height()/3,f=Math.ceil(c.offsetX/d),g=Math.ceil(c.offsetY/e),h="left",i="top";switch(f){case 1:h="left";break;case 2:h="center";break;case 3:h="right"}switch(g){case 1:i="top";break;case 2:i="center";break;case 3:i="bottom"}var j=h+"-"+i,k=j!==a.value;a.value=j,a.onChange&&k&&a.onChange()}})}]}}]).directive("facebookThumbnailBlockControl",["utils",function(a){return{restrict:"A",replace:!0,template:'<div class="facebook-thumbnail_block_control">   <div class="block_header">       <div class="block_title">{{title}}</div>       <label class="checkbox is_active" data-ng-show="!!optional"><input type="checkbox" data-ng-model="model.active" title="Show block"/> enable</label>   </div>   <div class="tabs" data-ng-show="tabs.length > 1">       <div class="tab image" data-ng-show="isTabShown(\'image\')" data-ng-class="{active: \'image\' === tab}" data-ng-click="tab=\'image\'">Image</div>       <div class="tab text" data-ng-show="isTabShown(\'text\')" data-ng-class="{active: \'text\' === tab}" data-ng-click="tab=\'text\'">Text</div>       <div class="tab position" data-ng-show="isTabShown(\'position\')" data-ng-class="{active: \'position\' === tab}" data-ng-click="tab=\'position\'">Position</div>       <div class="tab box" data-ng-show="isTabShown(\'box\')" data-ng-class="{active: \'box\' === tab}" data-ng-click="tab=\'box\'">Box</div>   </div>   <div class="form image" data-ng-show="\'image\' === tab">       <div class="image_picker" data-media-picker data-mode="url" data-size="full" data-model="model.url" data-picker-button-text="Pick Image" data-title="Pick Image">           {{imageHint}}       </div>   </div>   <div class="form position" data-ng-show="\'position\' === tab">       <div class="block_field anchor">           <label>{{"Anchor" | nls}}:</label>           <select data-ng-model="model.anchor" data-ng-options="anchor as text for (anchor, text) in anchors" data-ng-change="convertBlockStyle()"></select>           <div data-facebook-anchor-picker data-value="model.anchor" data-on-change="convertBlockStyle()"></div>       </div>       <div class="block_field size_field coord_x">           <label>{{"Coord X" | nls}}:</label>           <input type="number" data-ng-model="model.x" min="0">           <select data-ng-model="model.unitX" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>       </div>       <div class="block_field size_field coord_y">           <label>{{"Coord Y" | nls}}:</label>           <input type="number" data-ng-model="model.y" min="0">           <select data-ng-model="model.unitY" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>       </div>       <div class="block_field size_field width">           <label>{{"Width" | nls}}:</label>           <input type="number" data-ng-model="model.width" min="0">           <select data-ng-model="model.unitWidth" data-ng-options="unit for unit in units" data-ng-change="convertBlockStyle()"></select>       </div>   </div>   <div class="form text" data-ng-show="\'text\' === tab">       <div class="block_field color_field block_font_color color_picker">           <label>Color</label>           <input type="color" data-ng-model="model.color" data-default-color="#FFFFFF" data-color-picker title="Font color"/>       </div>       <div class="block_field font_field font_size">           <label>Font</label>           <select data-ng-model="model.fontFamily" title="Font size" data-ng-options="font for font in fonts" data-ng-show="!!fonts.length"></select>           <input type="number" data-ng-model="model.fontSize" title="Font size" min="0"/>       </div>       <div class="block_field text_align">           <label>Text align</label>           <span class="button dashicons-before dashicons-editor-alignleft" data-ng-class="{active: \'left\'===model.textAlign}" data-ng-click="model.textAlign = \'left\'"></span>           <span class="button dashicons-before dashicons-editor-aligncenter" data-ng-class="{active: \'center\'===model.textAlign}" data-ng-click="model.textAlign = \'center\'"></span>           <span class="button dashicons-before dashicons-editor-alignright" data-ng-class="{active: \'right\'===model.textAlign}" data-ng-click="model.textAlign = \'right\'"></span>       </div>   </div>   <div class="form box" data-ng-show="\'box\' === tab">       <div class="block_field color_field background_color color_picker">           <label>Background color</label>           <input type="color" data-ng-model="model.backgroundColor" data-default-color="#000000" data-color-picker title="Background color"/>       </div>       <div class="block_field background_opacity">           <label>Background opacity</label>           <input type="number" data-ng-model="model.backgroundOpacity" title="Background opacity" min="0" max="100"/>       </div>       <div class="block_field color_field border_color color_picker">           <label>Border color</label>           <input type="color" data-ng-model="model.borderColor" data-default-color="#ffffff" data-color-picker title="Border color"/>       </div>       <div class="block_field border_width" data-ng-show="model.borderWidth >= 0">           <label>Border width</label>           <input type="number" data-ng-model="model.borderWidth" title="Border width" min="0"/>       </div>       <div class="block_field border_width" data-ng-show="model.borderWidth < 0">           <label>Border width top</label>           <input type="number" data-ng-model="model.borderWidthTop" title="Border width top" min="0"/>       </div>       <div class="block_field border_width" data-ng-show="model.borderWidth < 0">           <label>Border width right</label>           <input type="number" data-ng-model="model.borderWidthRight" title="Border width right" min="0"/>       </div>       <div class="block_field border_width" data-ng-show="model.borderWidth < 0">           <label>Border width bottom</label>           <input type="number" data-ng-model="model.borderWidthBottom" title="Border width bottom" min="0"/>       </div>       <div class="block_field border_width" data-ng-show="model.borderWidth < 0">           <label>Border width left</label>           <input type="number" data-ng-model="model.borderWidthLeft" title="Border width left" min="0"/>       </div>       <div class="block_field padding">           <label>Padding</label>           <input type="number" data-ng-model="model.padding" title="padding" min="0"/>       </div>   </div></div>',scope:{api:"=?facebookThumbnailBlockControl",model:"=",block:"@",optional:"@?",title:"@",tabsStr:"@tabs",imageHint:"@?",text:"=?",fonts:"=?"},controller:["$scope",function(b){angular.extend(b,{tabs:b.tabsStr&&b.tabsStr.split(/\s+/)||[],units:["px","%"],anchors:{"left-top":"Top Left","center-top":"Top Center","right-top":"Top Right","left-center":"Center Left","center-center":"Center","right-center":"Center Right","left-bottom":"Bottom Left","center-bottom":"Bottom Center","right-bottom":"Bottom Right"},init:function(){b.tab=b.tabs[0],b.isTabShown("position")&&a.setDefaults(b.model,{x:0,unitX:"px",y:0,unitY:"px",width:50,unitWidth:"%",anchor:"left-top"}),b.isTabShown("text")&&a.setDefaults(b.model,{fontFamily:"",fontSize:20,color:"#ffffff",textAlign:"left"}),b.isTabShown("box")&&a.setDefaults(b.model,{backgroundColor:"#000000",backgroundOpacity:0,borderColor:"#ffffff",borderWidth:0,borderWidthTop:0,borderWidthRight:0,borderWidthBottom:0,borderWidthLeft:0,padding:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0})},isTabShown:function(a){return b.tabs.indexOf(a)>=0},hashColorAndOpacityToRGB:function(a,b){a=a.replace("#",""),3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var c=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),e=parseInt(a.substring(4,6),16);return"rgba("+c+","+d+","+e+","+b/100+")"},convertBlockStyle:function(c){var d=b.$parent.getThumbnailElement(b.block),e=d.position(),f=b.model,g=e.left,h=a.getItem(f,"unitX","px"),i=e.top,j=a.getItem(f,"unitY","px"),k=d.outerWidth(),l=d.outerHeight(),m=a.getItem(f,"unitWidth","%"),n=a.getItem(f,"anchor","left-top"),o=d.parent().width(),p=d.parent().height();switch(n){default:case"left-top":break;case"center-top":g+=Math.floor(k/2);break;case"right-top":g+=Math.floor(k);break;case"left-center":i+=Math.floor(l/2);break;case"center-center":g+=Math.floor(k/2),i+=Math.floor(l/2);break;case"right-center":g+=Math.floor(k),i+=Math.floor(l/2);break;case"left-bottom":i+=l;break;case"center-bottom":g+=Math.floor(k/2),i+=l;break;case"right-bottom":g+=Math.floor(k),i+=Math.floor(l/2)}var q="%"===j?Math.round(i/p*100):i,r="%"===h?Math.round(g/o*100):g,s="%"===m?Math.round(k/o*100):k;angular.extend(b.model,{x:r,y:q,width:s})},getBlockStyle:function(){var c=b.$parent.getThumbnailElement(b.block),d=b.model,e={};if(b.isTabShown("text")&&angular.extend(e,{"font-family":d.fontFamily||"inherit","font-size":d.fontSize?d.fontSize+"px":"1em",color:d.color||"#FFFFFF","text-align":d.textAlign}),b.isTabShown("position")){var f=a.getItem(d,"x",0),g=a.getItem(d,"unitX","px"),h=a.getItem(d,"y",0),i=a.getItem(d,"unitY","px"),j=a.getItem(d,"width",50),k=a.getItem(d,"unitWidth","%"),l=a.getItem(d,"anchor","left-top"),m=c.outerWidth(),n=c.outerHeight(),o=m/n,p=c.parent().width(),q=c.parent().height(),r="%"===i?Math.round(h/100*q):h,s="%"===g?Math.round(f/100*p):f,t="%"===k?Math.round(j/100*p):j,u=Math.round(t/o);switch(l){default:case"left-top":break;case"center-top":s-=Math.floor(t/2);break;case"right-top":s-=Math.floor(t);break;case"left-center":r-=Math.floor(u/2);break;case"center-center":s-=Math.floor(t/2),r-=Math.floor(u/2);break;case"right-center":s-=Math.floor(t),r-=Math.floor(u/2);break;case"left-bottom":r-=u;break;case"center-bottom":s-=Math.floor(t/2),r-=u;break;case"right-bottom":s-=Math.floor(t),r-=Math.floor(u/2)}angular.extend(e,{top:r,left:s,width:t})}if(b.isTabShown("box")){var v=d.borderWidth&&d.borderWidth+"px"||"0",w=[];d.borderWidth<0&&(w.push((d.borderWidthTop&&d.borderWidthTop+"px"||0)+""),w.push((d.borderWidthRight&&d.borderWidthRight+"px"||0)+""),w.push((d.borderWidthBottom&&d.borderWidthBottom+"px"||0)+""),w.push((d.borderWidthLeft&&d.borderWidthLeft+"px"||0)+""),v=w.join(" "));var x=d.padding&&d.padding+"px"||"0",y=[];d.borderWidth<0&&(y.push((d.paddingTop&&d.paddingTop+"px"||0)+""),y.push((d.paddingRight&&d.paddingRight+"px"||0)+""),y.push((d.paddingBottom&&d.paddingBottom+"px"||0)+""),y.push((d.paddingLeft&&d.paddingLeft+"px"||0)+""),x=y.join(" ")),angular.extend(e,{"background-color":b.hashColorAndOpacityToRGB(d.backgroundColor||"#000",d.backgroundOpacity||0),border:"solid "+d.borderColor,"border-width":v,padding:x})}return b.optional&&(e=d.active?angular.extend(e,{visibility:"visible"}):{visibility:"hidden"}),e},renderBlock:function(){}}),b.init(),b.api={getBlockStyle:b.getBlockStyle}}]}}]);